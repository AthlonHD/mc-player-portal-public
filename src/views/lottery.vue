<template>

  <content>
    <Alert>提示：手机用户请横屏使用</Alert>

    <Card style="width:95%; height: 73%; margin: 20px auto 0;">
      <row style="margin: auto">
        <Col span="24">
          <Card style="width:95%; height: 80px; margin: 10px auto 20px;">
            <div style="text-align:center">
              <h1>当前奖池</h1>
            </div>
          </Card>
        </Col>
      </row>

      <row>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/wujinqidian.png" alt="wujinqidian" height="40" style="margin: auto">
            <h5 style="width: 50px">无尽奇点</h5>
            <h5>x1</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/wujinqiaochi.png" height="40" alt="wujinqiaochi">
            <h5 style="width: 60px">无尽鞘翅</h5>
            <h5>核心</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/pinghuashitou.png" height="40" alt="pinghuashitou">
            <h5 style="width: 50px">无尽圆石</h5>
            <h5>发生器</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/wujingong.png" height="40" alt="wujingong">
            <h5 style="width: 50px">天堂陨落</h5>
            <h5>长弓</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/xukongweili.png" height="40" alt="xukongweili">
            <h5 style="width: 50px">虚空微粒</h5>
            <h5>发生器</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/haiyang.png" height="40" alt="haiyang">
            <h5 style="width: 50px">海洋之星</h5>
            <h5>x1</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/longdan.png" alt="longdan" height="40" style="margin: auto">
            <h5>龙蛋</h5>
            <h5>x1</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/shuilifadian.png" alt="shuilifadian" height="40" style="margin: auto">
            <h5 style="width: 50px">加强水力</h5>
            <h5 style="width: 50px">发电机</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/chenghao.png" height="40" alt="chenghao">
            <h5>称号</h5>
            <h5>幸运星</h5>
          </div>
        </Card>

      </row>

      <row style="margin: 20px auto auto;">

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongban_1.png" height="40" alt="tongban_1">
            <h5>铜板</h5>
            <h5>￥50</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongban_2.png" height="40" alt="tongban_2">
            <h5>铜板</h5>
            <h5>￥100</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongban_3.png" height="40" alt="tongban_3">
            <h5>铜板</h5>
            <h5>￥200</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongban_4.png" height="40" alt="tongban_4">
            <h5>铜板</h5>
            <h5>￥500</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongban_5.png" height="40" alt="tongban_5">
            <h5>铜板</h5>
            <h5>￥1000</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongban_safe.png" height="40" alt="tongban_safe">
            <h5>铜板</h5>
            <h5>￥5000</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongban_card.png" height="40" alt="tongban_card">
            <h5>铜板</h5>
            <h5>￥10000</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/chenghaobi.png" height="40" alt="chenghaobi">
            <h5>称号币</h5>
            <h5>$1</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/chenghaobi.png" height="40" alt="chenghaobi">
            <h5>称号币</h5>
            <h5>$5</h5>
          </div>
        </Card>

      </row>

      <row style="margin: 20px auto auto;">

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/qianghuahejin.png" height="40" alt="qianghuahejin">
            <h5 style="width: 50px">强化合金</h5>
            <h5>x64</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/qipaoding.png" height="40" alt="qipaoding">
            <h5>起泡锭</h5>
            <h5>x64</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/heijingangshi.png" height="40" alt="heijingangshi">
            <h5 style="width: 50px">黑金刚石</h5>
            <h5>x64</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/xiajiezhixing.png" height="40" alt="xiajiezhixing">
            <h5 style="width: 60px">下界之星</h5>
            <h5>x64</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/jingyan.png" height="40" alt="jingyan">
            <h5>经验</h5>
            <h5>+22888</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/fumoshu.png" height="40" alt="fumoshu">
            <h5 style="width: 60px">随机附魔书</h5>
            <h5>普通x1</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/fumoshu.png" height="40" alt="fumoshu">
            <h5 style="width: 60px">随机附魔书</h5>
            <h5>稀有x1</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/fumoshu.png" height="40" alt="fumoshu">
            <h5 style="width: 60px">随机附魔书</h5>
            <h5>史诗x1</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/fumoshu.png" height="40" alt="fumoshu">
            <h5 style="width: 60px">随机附魔书</h5>
            <h5>传说x1</h5>
          </div>
        </Card>

      </row>

      <row style="margin: 20px auto auto;">

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/jinding24.png" height="40" alt="jinding24">
            <h5 style="width: 50px">金锭</h5>
            <h5 style="width: 50px">24克拉</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/qianfen.png" height="40" alt="qianfen">
            <h5 style="width: 50px">铅粉</h5>
            <h5>x128</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/mei.png" height="40" alt="mei">
            <h5 style="width: 50px">镁</h5>
            <h5>x128</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tiefen.png" height="40" alt="tiefen">
            <h5 style="width: 50px">铁粉</h5>
            <h5>x128</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/jinfen.png" height="40" alt="jinfen">
            <h5 style="width: 50px">金粉</h5>
            <h5>x128</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/tongfen.png" height="40" alt="tongfen">
            <h5 style="width: 50px">铜粉</h5>
            <h5>x128</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/xinfen.png" height="40" alt="xinfen">
            <h5 style="width: 50px">锌粉</h5>
            <h5>x128</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/yinfen.png" height="40" alt="yinfen">
            <h5 style="width: 50px">银粉</h5>
            <h5>x128</h5>
          </div>
        </Card>

        <Card style="width:80px; height: 100px; margin: auto">
          <div style="text-align:center">
            <img src="../../public/lottery/lvfen.png" height="40" alt="lvfen">
            <h5 style="width: 50px">铝粉</h5>
            <h5>x128</h5>
          </div>
        </Card>


      </row>

    </Card>

    <Alert type="warning" style="width: 95%; margin: auto">首次使用需要绑定区服,不然无法正常抽奖并发放奖品。一旦绑定后无法修改。</Alert>

    <Form :model="formItem" :label-width="0">

      <FormItem style="margin: 10px auto auto;">

        <h3 style="margin: auto">请先绑定区服</h3>

        <RadioGroup v-model="button_server" type="button" button-style="solid" style="width: 400px;" onchange="">
          <Radio label="粘液一区"></Radio>
          <Radio label="粘液二区"></Radio>
          <Radio label="粘液三区"></Radio>
          <Radio label="粘液四区"></Radio>
        </RadioGroup>
        <Button type="primary" style="margin-right: 40px" @click="bindServer">绑定</Button>
        <Button type="info" icon="ios-search" shape="circle" @click="checkMoney">查询铜板</Button>

      </FormItem>

      <FormItem style="margin: 20px auto auto;">

        <Button type="primary" size="large" style="margin: auto" @click="singleSlot">点击抽奖 特惠￥75/一次</Button>

        <router-link to="/home/lottery-reward">
          <Button type="success" size="large" style="margin-left: 35px">进入发放奖励</Button>
        </router-link>


      </FormItem>


    </Form>

  </content>

</template>

<script>

import axios from "axios";

export default {
  name: "lottery",

  data: function () {
    return {
      formItem: {

      },

      button_server: '粘液一区',
      server: '0',

    };
  },


  inject: ['$authing'],
  mounted: function () {
    this.userInfo = localStorage.getItem('userInfo');
    console.log(this.userInfo)

  },

  methods: {

    bindServer: function () {
      let _this = this
      console.log(_this.userInfo);
      let userinfo = JSON.parse(_this.userInfo)
      let sub_id = userinfo.sub
      console.log(sub_id)

      let button_server = this.button_server
      console.log(button_server)
      let server = this.server
      if (button_server === '粘液一区') {
        server = '0'
      } else if (button_server === '粘液二区') {
        server = '1'
      } else if (button_server === '粘液三区') {
        server = '2'
      } else if (button_server === '粘液四区') {
        server = '3'
      }
      console.log(server)

      axios({
        method: 'post',
        baseURL: '/api',
        url: '/lottery.bindserver',
        header: 'application/json',
        data: {
          'sub_id': sub_id,
          'bind_server': server
        }
      })
        .then(function (response) {
          console.log(response);
          console.log(response.data);
          _this.response = response.data
          let code = _this.response.code

          if (code === '0') {
            _this.$Notice.success({title: '绑定成功！'})
          } else if (code === '100') {
            _this.$Notice.warning({title: '您已绑定区服，请勿重复绑定！'})
          }

        })
        .catch(function (error) {
          console.log(error);
          _this.response = error
          _this.error()

        });

    },

    checkMoney: function () {
			let _this = this;
      console.log(_this.userInfo);
      let userinfo = JSON.parse(_this.userInfo)
      let sub_id = userinfo.sub
      console.log(sub_id)

			axios({
				method: 'post',
				baseURL: '/api',
				url: '/lottery.checkmoney',
				header: 'application/json',
				data: {
          'sub_id': sub_id
        }
      })
        .then(function (response) {
          console.log(response);
          console.log(response.data);
          _this.response = response.data
          let code = _this.response.code
          let data = _this.response.data

          if (code === '0') {
            _this.$Notice.success({title: '查询成功', desc: data})
          } else if (code === '100') {
            _this.$Notice.error({title: '请先绑定账号！'})
          }

        })
        .catch(function (error) {
					console.log(error);
					_this.response = error
          _this.error()

				});
    },

    lotterySuccess: function (content) {
      let _this = this
      _this.$Loading.finish()
      _this.$Modal.success({title:'恭喜抽到！', content:'<h1>' + content + '</h1>'})

    },

    singleSlot: function () {
      let _this = this
      console.log(_this.userInfo);
      let userinfo = JSON.parse(_this.userInfo)
      let sub_id = userinfo.sub
      console.log(sub_id)

      _this.$Loading.config({
        color: '#ffffff',
        failedColor: '#f0ad4e',
        height: 5
      });

      _this.$Loading.start()

      axios({
        method: 'post',
        baseURL: '/api',
        url: '/lottery.single',
        header: 'application/json',
        data: {
          'sub_id': sub_id
        }
      })
        .then(function (response) {
          console.log(response);
          console.log(response.data);
          _this.response = response.data
          let code = _this.response.code
          let data = _this.response.data

          if (code === '0') {
            _this.$Message.success('支付成功')
            _this.lotterySuccess(data)

          } else if (code === '200') {
            _this.$Loading.finish()
            _this.$Notice.warning({title:'余额不足！'})
          } else if (code === '100') {
            _this.$Loading.finish()
            _this.$Notice.warning({title:'请先绑定账号！'})
          }

        })
        .catch(function (error) {
					console.log(error);
					_this.response = error
          _this.error()

				});
    },


  }

}

</script>

<style scoped>

</style>
